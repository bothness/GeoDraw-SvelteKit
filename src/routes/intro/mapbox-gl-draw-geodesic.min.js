!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).MapboxDrawGeodesic={})}(this,(function(t){"use strict";const e="add",r="none",o="Feature",n="Polygon",i="LineString",s="Point",a="Multi",c="MultiLineString",h="draw.create",u="midpoint",l="vertex",p="true",f="false",d={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static",DRAW_CIRCLE:"draw_circle"},g="circleRadius",M="circleHandleBearing";var y={exports:{}},m=y.exports=function(t,e){if(e||(e=16),void 0===t&&(t=128),t<=0)return"0";for(var r=Math.log(Math.pow(2,t))/Math.log(e),o=2;r===1/0;o*=2)r=Math.log(Math.pow(2,t/o))/Math.log(e)*o;var n=r-Math.floor(r),i="";for(o=0;o<Math.floor(r);o++){i=Math.floor(Math.random()*e).toString(e)+i}if(n){var s=Math.pow(e,n);i=Math.floor(Math.random()*s).toString(e)+i}var a=parseInt(i,e);return a!==1/0&&a>=Math.pow(2,t)?m(t,e):i};m.rack=function(t,e,r){var o=function(o){var i=0;do{if(i++>10){if(!r)throw new Error("too many ID collisions, use more bits");t+=r}var s=m(t,e)}while(Object.hasOwnProperty.call(n,s));return n[s]=o,s},n=o.hats={};return o.get=function(t){return o.hats[t]},o.set=function(t,e){return o.hats[t]=e,o},o.bits=t||128,o.base=e||16,o};var x=y.exports;function v(t,e,r={}){if(!(e>0))throw new Error("Radius has to be greater then 0");return{id:x(),type:o,properties:{[g]:e,...r},geometry:{type:n,coordinates:[[t,t,t,t]]}}}function E(t){return t.geometry.type===n&&"number"==typeof t.properties[g]&&t.properties[g]>0}function w(t){if(!E(t))throw new Error("GeoJSON is not a circle");return t.geometry.coordinates[0][0]}function S(t){if(!E(t))throw new Error("GeoJSON is not a circle");return t.properties[g]}var _={exports:{}};!function(t){var e=Math.PI/180,r=180/Math.PI,o=function(t,r){this.lon=t,this.lat=r,this.x=e*t,this.y=e*r};o.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},o.prototype.antipode=function(){var t=-1*this.lat,e=this.lon<0?180+this.lon:-1*(180-this.lon);return new o(e,t)};var n=function(){this.coords=[],this.length=0};n.prototype.move_to=function(t){this.length++,this.coords.push(t)};var i=function(t){this.properties=t||{},this.geometries=[]};i.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1==this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var t=[],e=0;e<this.geometries.length;e++)t.push(this.geometries[e].coords);return{geometry:{type:"MultiLineString",coordinates:t},type:"Feature",properties:this.properties}},i.prototype.wkt=function(){for(var t="",e="LINESTRING(",r=function(t){e+=t[0]+" "+t[1]+","},o=0;o<this.geometries.length;o++){if(0===this.geometries[o].coords.length)return"LINESTRING(empty)";this.geometries[o].coords.forEach(r),t+=e.substring(0,e.length-1)+")"}return t};var s=function(t,e,r){if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new o(t.x,t.y),this.end=new o(e.x,e.y),this.properties=r||{};var n=this.start.x-this.end.x,i=this.start.y-this.end.y,s=Math.pow(Math.sin(i/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(n/2),2);if(this.g=2*Math.asin(Math.sqrt(s)),this.g==Math.PI)throw new Error("it appears "+t.view()+" and "+e.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+t+" and "+e)};s.prototype.interpolate=function(t){var e=Math.sin((1-t)*this.g)/Math.sin(this.g),o=Math.sin(t*this.g)/Math.sin(this.g),n=e*Math.cos(this.start.y)*Math.cos(this.start.x)+o*Math.cos(this.end.y)*Math.cos(this.end.x),i=e*Math.cos(this.start.y)*Math.sin(this.start.x)+o*Math.cos(this.end.y)*Math.sin(this.end.x),s=e*Math.sin(this.start.y)+o*Math.sin(this.end.y),a=r*Math.atan2(s,Math.sqrt(Math.pow(n,2)+Math.pow(i,2)));return[r*Math.atan2(i,n),a]},s.prototype.Arc=function(t,e){var r=[];if(!t||t<=2)r.push([this.start.lon,this.start.lat]),r.push([this.end.lon,this.end.lat]);else for(var o=1/(t-1),s=0;s<t;++s){var a=o*s,c=this.interpolate(a);r.push(c)}for(var h=!1,u=0,l=e&&e.offset?e.offset:10,p=180-l,f=-180+l,d=360-l,g=1;g<r.length;++g){var M=r[g-1][0],y=r[g][0],m=Math.abs(y-M);m>d&&(y>p&&M<f||M>p&&y<f)?h=!0:m>u&&(u=m)}var x=[];if(h&&u<l){var v=[];x.push(v);for(var E=0;E<r.length;++E){var w=parseFloat(r[E][0]);if(E>0&&Math.abs(w-r[E-1][0])>d){var S=parseFloat(r[E-1][0]),_=parseFloat(r[E-1][1]),C=parseFloat(r[E][0]),I=parseFloat(r[E][1]);if(S>-180&&S<f&&180==C&&E+1<r.length&&r[E-1][0]>-180&&r[E-1][0]<f){v.push([-180,r[E][1]]),E++,v.push([r[E][0],r[E][1]]);continue}if(S>p&&S<180&&-180==C&&E+1<r.length&&r[E-1][0]>p&&r[E-1][0]<180){v.push([180,r[E][1]]),E++,v.push([r[E][0],r[E][1]]);continue}if(S<f&&C>p){var b=S;S=C,C=b;var L=_;_=I,I=L}if(S>p&&C<f&&(C+=360),S<=180&&C>=180&&S<C){var N=(180-S)/(C-S),P=N*I+(1-N)*_;v.push([r[E-1][0]>p?180:-180,P]),(v=[]).push([r[E-1][0]>p?-180:180,P]),x.push(v)}else v=[],x.push(v);v.push([w,r[E][1]])}else v.push([r[E][0],r[E][1]])}}else{var T=[];x.push(T);for(var D=0;D<r.length;++D)T.push([r[D][0],r[D][1]])}for(var O=new i(this.properties),F=0;F<x.length;++F){var R=new n;O.geometries.push(R);for(var G=x[F],A=0;A<G.length;++A)R.move_to(G[A])}return O},t.exports.Coord=o,t.exports.Arc=i,t.exports.GreatCircle=s}(_);var C=_.exports;function I(t,e){return t[0]===e[0]&&t[1]===e[1]}function b(t,e=32){var r;const o=(r=t).slice(0,-1).map(((t,e)=>[t,r[e+1]])).filter((t=>!I(t[0],t[1]))).map((t=>new C.GreatCircle({x:t[0][0],y:t[0][1]},{x:t[1][0],y:t[1][1]}).Arc(e,{offset:90}).json()));let n=0;const i=o.map((t=>{if(t.geometry.type===c){const e=n,r=n+(t.geometry.coordinates[0][0][0]>t.geometry.coordinates[1][0][0]?1:-1),o=[...t.geometry.coordinates[0].map((t=>[t[0]+360*e,t[1]])),...t.geometry.coordinates[1].map((t=>[t[0]+360*r,t[1]]))];return n=r,o}return t.geometry.coordinates.map((t=>[t[0]+360*n,t[1]]))})).flat();return i.filter(((t,e)=>e===i.length-1||!I(t,i[e+1])))}function L(t){return t/180*Math.PI}function N(t){return t/Math.PI*180}function P(t,e){if(r=t,o=e,!(Math.abs(r[0]-o[0])>Number.EPSILON||Math.abs(r[1]-o[1])>Number.EPSILON))return NaN;var r,o;const n=L(t[1]),i=L(e[1]),s=L(e[0]-t[0]),a=Math.cos(n)*Math.sin(i)-Math.sin(n)*Math.cos(i)*Math.cos(s),c=Math.sin(s)*Math.cos(i),h=N(Math.atan2(c,a));return(h+360)%360}const T=6371.0088;function D(t,e){return function(t,e,r=6371e3){const o=r,n=L(t[1]),i=L(t[0]),s=L(e[1]),a=s-n,c=L(e[0])-i,h=Math.sin(a/2)*Math.sin(a/2)+Math.cos(n)*Math.cos(s)*Math.sin(c/2)*Math.sin(c/2);return o*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))}(t,e,T)}function O(t,e,r){return function(t,e,r,o=6371e3){const n=e/o,i=L(r),s=L(t[1]),a=L(t[0]),c=Math.sin(s)*Math.cos(n)+Math.cos(s)*Math.sin(n)*Math.cos(i),h=Math.asin(c),u=Math.sin(i)*Math.sin(n)*Math.cos(s),l=Math.cos(n)-Math.sin(s)*c,p=a+Math.atan2(u,l),f=N(h);return[N(p),f]}(t,e,r,T)}function F(t,e){const r=e.split(".").map((t=>parseInt(t,10))).reduce(((t,e)=>t[e]),t);return JSON.parse(JSON.stringify(r))}function R(t,e){e={steps:32,...e};const r=t.properties,c=t.geometry.type,h=t.geometry.coordinates,d=r.parent||r.id,g=e.ctx.store.get(d),y=g.toGeoJSON();if(c===s)return r.meta!==l&&r.meta!==u||!E(y)?r.meta===u?function(){const e=r.coord_path,o=e.split(".").map((t=>parseInt(t,10))),n=o.map(((t,e)=>t+(e===o.length-1?-1:0))).join("."),i=e,s=F(y.geometry.coordinates,n),a=F(y.geometry.coordinates,i),c=function(t,e){const r=L(t[1]),o=L(t[0]),n=L(e[1]),i=L(e[0]-t[0]),s=Math.cos(r),a=0,c=Math.sin(r),h={x:s+Math.cos(n)*Math.cos(i),y:a+Math.cos(n)*Math.sin(i),z:c+Math.sin(n)},u=Math.atan2(h.z,Math.sqrt(h.x*h.x+h.y*h.y)),l=o+Math.atan2(h.y,h.x),p=N(u);return[N(l),p]}(s,a);return[{...t,properties:{...r,lng:c[0],lat:c[1]},geometry:{...t.geometry,coordinates:c}}]}():[t]:[];if(c===i)return function(){const r=b(h,e.steps);return[{...t,geometry:{...t.geometry,coordinates:r}}]}();if(c===n)return E(y)?function(){const n=w(y),i=S(y),a=g[M]||45,c=function(t,e,r,o){const n=[];for(let i=0;i<o;++i)n.push(O(t,e,r+360*-i/o));return n.push(n[0]),n}(n,i,a,4*e.steps),h={...t,geometry:{...t.geometry,coordinates:[c]}};if(r.active===p){return[h,...[n,O(n,i,a)].map(((t,n)=>function(t,e,r,n){return{type:o,properties:{meta:l,parent:t,coord_path:r,active:n?p:f},geometry:{type:s,coordinates:e}}}(r.id,t,`0.${n}`,function(t){if(!e.selectedPaths)return!1;return-1!==e.selectedPaths.indexOf(t)}(`0.${n}`))))]}return[h]}():function(){const e=h.map((t=>b(t)));return[{...t,geometry:{...t.geometry,coordinates:e}}]}();if(0===c.indexOf(a))return function(){const n=c.replace(a,""),i=h.map((t=>R({type:o,properties:r,geometry:{type:n,coordinates:t}},e))).flat().map((t=>t.geometry.coordinates));return[{...t,geometry:{...t.geometry,coordinates:i}}]}()}function G(t){const e={...t};return e.toDisplayFeatures=function(e,r,o){t.toDisplayFeatures.call(this,e,r,(t=>{R(t,{ctx:this._ctx}).forEach(o)}))},e}function A(t){const e={...t};return e.toDisplayFeatures=function(e,r,o){t.toDisplayFeatures.call(this,e,r,(t=>{R(t,{ctx:this._ctx}).forEach(o)}))},e}var W={enable(t){setTimeout((()=>{t.map&&t.map.doubleClickZoom&&t._ctx&&t._ctx.store&&t._ctx.store.getInitialConfigValue&&t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()}),0)},disable(t){setTimeout((()=>{t.map&&t.map.doubleClickZoom&&t.map.doubleClickZoom.disable()}),0)}};const k={enable(t){setTimeout((()=>{t.map&&t.map.dragPan&&t._ctx&&t._ctx.store&&t._ctx.store.getInitialConfigValue&&t._ctx.store.getInitialConfigValue("dragPan")&&t.map.dragPan.enable()}),0)},disable(t){setTimeout((()=>{t.map&&t.map.doubleClickZoom&&t.map.dragPan.disable()}),0)}},J={};function j(t){const e={...t};return e.toDisplayFeatures=function(e,r,o){t.toDisplayFeatures.call(this,e,r,(t=>{R(t,{ctx:this._ctx}).forEach(o)}))},e}function V(t){const e={...t};return e.toDisplayFeatures=function(e,r,o){t.toDisplayFeatures.call(this,e,r,(t=>{R(t,{ctx:this._ctx}).forEach(o)}))},e}function Z(t){const e={...t};return e.dragVertex=function(e,r,o){const n=e.feature.toGeoJSON();if(E(n))if("0.1"===e.selectedCoordPaths[0]){const t=w(n),o=[r.lngLat.lng,r.lngLat.lat],i=D(t,o),s=P(t,o);e.feature.properties[g]=i,e.feature[M]=s,e.feature.changed()}else t.dragFeature.call(this,e,r,o);else t.dragVertex.call(this,e,r,o)},e.toDisplayFeatures=function(e,r,o){t.toDisplayFeatures.call(this,e,r,(t=>{R(t,{ctx:this._ctx,selectedPaths:e.selectedCoordPaths}).forEach(o)}))},e}J.onSetup=function(t){return this.clearSelectedFeatures(),W.disable(this),k.disable(this),this.updateUIClasses({mouse:e}),this.setActionableState(),{}},J.onMouseDown=J.onTouchStart=function(t,e){const r=[e.lngLat.lng,e.lngLat.lat],o=this.newFeature(v(r,Number.EPSILON));this.addFeature(o),t.circle=o},J.onDrag=J.onTouchMove=function(t,e){if(t.circle){const r=w(t.circle.toGeoJSON()),o=[e.lngLat.lng,e.lngLat.lat],n=D(r,o),i=P(r,o);t.circle.properties[g]=n,t.circle[M]=i,t.circle.changed()}},J.onMouseUp=J.onTouchEnd=function(t,e){return this.map.fire(h,{features:[t.circle.toGeoJSON()]}),this.changeMode(d.SIMPLE_SELECT,{featureIds:[t.circle.id]})},J.onKeyUp=function(t,e){!function(t){return 27===t.keyCode}(e)?function(t){return 13===t.keyCode}(e)&&this.changeMode(d.SIMPLE_SELECT,{featureIds:[t.circle.id]}):(t.circle&&this.deleteFeature([t.circle.id],{silent:!0}),this.changeMode(d.SIMPLE_SELECT))},J.onStop=function(){this.updateUIClasses({mouse:r}),W.enable(this),k.enable(this),this.activateUIButton()},J.toDisplayFeatures=function(t,e,r){if(t.circle){const r=e.properties.id===t.circle.id;e.properties.active=r?p:f}(t=>{R(t,{ctx:this._ctx}).forEach(r)})(e)};const q={};q.onSetup=function(){return this.setActionableState(),{}},q.toDisplayFeatures=function(t,e,r){(t=>{R(t,{ctx:this._ctx}).forEach(r)})(e)},t.createCircle=v,t.enable=function(t){return{...t,[d.DRAW_LINE_STRING]:G(t[d.DRAW_LINE_STRING]),[d.DRAW_POLYGON]:A(t[d.DRAW_POLYGON]),[d.DRAW_CIRCLE]:J,[d.DRAW_POINT]:j(t[d.DRAW_POINT]),[d.SIMPLE_SELECT]:V(t[d.SIMPLE_SELECT]),[d.DIRECT_SELECT]:Z(t[d.DIRECT_SELECT]),[d.STATIC]:q}},t.getCircleCenter=w,t.getCircleRadius=S,t.isCircle=E,t.setCircleCenter=function(t,e){if(!E(t))throw new Error("GeoJSON is not a circle");t.geometry.coordinates=[[e,e,e,e]]},t.setCircleRadius=function(t,e){if(!E(t))throw new Error("GeoJSON is not a circle");t.properties[g]=e},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=mapbox-gl-draw-geodesic.min.js.map
